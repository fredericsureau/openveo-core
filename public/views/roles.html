<div class="roles">
  <h2 ng-bind="'ROLES.TITLE' | translate"></h2>
  <div class="well well-lg" ng-bind="'ROLES.INFO' | translate"></div>
  <p class="ng-hide" ng-show="!roles.length" ng-bind="'ROLES.NO_DATA' | translate"></p>
  
  <div class="ng-hide" ng-show="roles.length">
  
    <div class="row header">
      <div class="col-xs-12 col-sm-10"><strong ng-bind="'ROLES.NAME_COLUMN' | translate"></strong></div>
      <div class="col-xs-2 hidden-xs"><strong ng-bind="'ROLES.ACTIONS_COLUMN' | translate"></strong></div>      
    </div>
    
    <div class="line bg-success" ng-repeat="role in roles">
      <div class="col-xs-12 col-sm-10" ng-click="toggleRoleDetails(role)">
        <span class="glyphicon" aria-hidden="true" ng-class="{'glyphicon-chevron-right' : !role.opened, 'glyphicon-chevron-down' : role.opened}"></span> <strong>[[role.name]]</strong>
      </div>
      <div class="col-xs-2 hidden-xs">
        <div class="actions dropdown" ng-click="toggleSubMenu($event)">
          <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
          <ul class="dropdown-menu" role="menu">          
            <li role="presentation"><a role="menuitem" href="#" ng-click="removeRole(role)" ng-bind="'ROLES.REMOVE' | translate"></a></li>
          </ul>
        </div>
      </div>      
      <div ng-if="role.opened">
        <div class="col-xs-12 detail">
          <form ov-form name="editForm" ng-submit="editForm.$valid && saveRole(editForm, role)" novalidate>
            <ul>

              <li class="form-inline">
                <div class="form-group">
                  <label class="label label-default control-label" ng-bind="'ROLES.ATTR_NAME' | translate"></label>
                  <ov-editable ov-name="name" ov-value="role.name" ov-type="text" ov-required="true" ov-disabled="editForm.saving" ng-class="{'has-error': editForm.name.$invalid && editForm.$submitted}">
                  </ov-editable>
                </div>
              </li>
              
              <li class="form-inline">
                <div class="form-group">
                  <label class="label label-default control-label" ng-bind="'ROLES.ATTR_PERMISSIONS' | translate"></label>

                  <div ng-repeat="permission in role.permissionsValues" ng-include="'rolePermissionsGroup'"></div>
                  <script type="text/ng-template" id="rolePermissionsGroup">

                    <div ng-if="permission.options && permission.values">
                      <div class="panel panel-primary">
                        <div class="panel-heading" ng-bind="permission.label | translate"></div>
                        <div class="panel-body">
                          <ov-editable ov-name="permissions" ov-options="permission.options" ov-value="permission.values" ov-type="checkbox" ov-required="false" ov-disabled="editForm.saving" ng-class="{'has-error': editForm.permissions.$invalid && editForm.$submitted}"></ov-editable> 

                          <div ng-if="permission.permissions && permission.values">
                            <div ng-repeat="permission in permission.permissions" ng-include="'rolePermissionsGroup'"></div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div ng-if="permission.permissions && !permission.values">
                      <div ng-repeat="permission in permission.permissions" ng-include="'rolePermissionsGroup'"></div>
                    </div>

                  </script>
                </div>
              </li>
              
            </ul>
            
            <div class="btn-group" role="group" ng-show="!editForm.edition">
              <button type="button" ng-click="openEdition(editForm);" class="btn btn-primary" ng-bind="'ROLES.FORM_EDIT' | translate"></button>
            </div>
            <div class="btn-group" role="group" ng-show="editForm.edition">
              <button type="button" ng-click="cancelEdition(editForm)" class="btn btn-default" ng-bind="'ROLES.FORM_CANCEL' | translate" ng-disabled="role.saving"></button>
              <button ng-show="editForm.edition" type="submit" class="btn btn-primary" ng-bind="'ROLES.FORM_SAVE' | translate" ng-disabled="role.saving"></button>
            </div>
          </form>
          
        </div>
      </div>      
    </div>
    
  </div>
  
  <hr/>
  
    <div class="col-xs-12 col-sm-12">
      <h4><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> <span ng-bind="'ROLES.ADD_ROLE' | translate"></span></h4>
      <form class="form-horizontal" name="addForm" ng-submit="addForm.$valid && addRole(addForm)" novalidate>
        
        <div class="row">
          <div class="col-xs-12 col-sm-6">
            <div class="form-group" ng-class="{'has-error': addForm.roleName.$invalid && addForm.$submitted}">
              <label for="roleName" ng-bind="'ROLES.FORM_ADD_NAME' | translate"></label>
              <input type="text" name="roleName" class="has-error form-control" id="roleName" placeholder="[['ROLES.FORM_ADD_NAME' | translate]]" ng-model="roleName" ng-disabled="addForm.saving" required>
              <small><em ng-bind="'ROLES.FORM_ADD_NAME_DESC' | translate"></em></small>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label ng-bind="'ROLES.FORM_ADD_PERMISSIONS' | translate"></label>

          <div ng-repeat="permission in addRolePermissions" ng-include="'permissionGroup'"></div>
          
          <script type="text/ng-template" id="permissionGroup">

            <div ng-if="permission.options && permission.values">
              <div class="panel panel-primary">
                <div class="panel-heading" ng-bind="permission.label | translate"></div>
                <div class="panel-body">
                  <label ng-repeat="option in permission.options" class="checkbox-inline">
                    <input type="checkbox" name="rolePermissions" ng-disabled="addForm.saving" ng-model="option.activated"> <span ng-bind="option.label | translate"></span>
                  </label>

                  <div ng-if="permission.permissions && permission.values">
                    <div ng-repeat="permission in permission.permissions" ng-include="'permissionGroup'"></div>
                  </div>
                </div>
              </div>
            </div>

            <div ng-if="permission.permissions && !permission.values">
              <div ng-repeat="permission in permission.permissions" ng-include="'permissionGroup'"></div>
            </div>

          </script>
          
          <div>
            <small><em ng-bind="'ROLES.FORM_ADD_PERMISSIONS_DESC' | translate"></em></small>
          </div>
        </div>
        
        <div class="form-group">
          <button type="submit" class="btn btn-primary" ng-bind="'ROLES.FORM_ADD_BUTTON' | translate" ng-disabled="addForm.saving"></button>
        </div>
        
      </form>
    </div>
  
</div>